---
import BaseLayout from "@/layouts/BaseLayout.astro";
import HubCard from "@/components/HubCard.astro";
import Breadcrumbs from "@/components/Breadcrumbs.astro";
import PageMastheadMedia from "@/components/PageMastheadMedia.astro";
import ContextRail from "@/components/ContextRail.astro";
import { getCategories, getTopLocations } from "@/lib/data";
import { buildSeo, clampMeta } from "@/lib/seo";
import { getPexelsImage } from "@/lib/pexelsImagePipeline";

const categories = getCategories().sort((a, b) => a.pluralName.localeCompare(b.pluralName));
const locations = getTopLocations(4);
const seo = buildSeo({
  path: "/categories/",
  title: "Service Categories in Malta",
  description: clampMeta("Browse service categories in Malta and find local providers, pricing guidance, and practical hiring tips.")
});

const breadcrumbs = [
  { name: "Home", url: "/" },
  { name: "Categories", url: "/categories/" }
];
---
<BaseLayout seo={seo} breadcrumbs={breadcrumbs}>
  <main>
    <PageMastheadMedia
      kicker="Category directory"
      title="Service Categories in Malta"
      description="Explore categories A-Z with practical checklists, local links, and direct paths into high-intent locality hubs."
      image={getPexelsImage("page-categories-index-hero", "Service categories in Malta")}
      actions={[{ href: "/locations/", label: "Browse localities", variant: "secondary" }]}
    />
    <section class="section">
      <div class="container">
        <Breadcrumbs items={breadcrumbs} />
        <div class="grid grid--cards mt-md">
          {categories.map((category) => (
            <HubCard
              title={category.pluralName}
              description={category.intro}
              href={`/categories/${category.slug}/`}
              chips={category.synonyms.slice(0, 3)}
              image={getPexelsImage(`category-${category.slug}-tile-1`, `${category.pluralName} in Malta`)}
            />
          ))}
        </div>
      </div>
    </section>
    <ContextRail
      title="Explore top locality jumps"
      items={locations.map((location) => ({
        title: `Services in ${location.name}`,
        href: `/locations/${location.slug}/`,
        meta: location.region || "Location hub",
        image: getPexelsImage(`featured-location-${location.slug}`, `${location.name} in Malta`)
      }))}
    />
  </main>
</BaseLayout>
