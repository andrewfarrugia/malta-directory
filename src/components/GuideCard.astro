---
import type { LocalPexelsImage } from "@/lib/pexelsImagePipeline";
import { toPictureData } from "@/lib/pexelsImagePipeline";

interface Props {
  title: string;
  description: string;
  href: string;
  dateUpdated?: string;
  image?: LocalPexelsImage;
  variant?: "default" | "tour";
  density?: "comfortable" | "compact";
  mediaShape?: "rounded" | "circle";
  sectionTone?: "light" | "muted";
  showMetaRow?: boolean;
  showCTA?: boolean;
}

const {
  title,
  description,
  href,
  dateUpdated,
  image,
  variant = "default",
  density = "comfortable",
  mediaShape = "rounded",
  sectionTone = "light",
  showMetaRow = true,
  showCTA = false
} = Astro.props as Props;
const picture = image ? toPictureData(image) : null;
---
<article class={`card media-card media-card--${variant} media-card--${density} media-card--${sectionTone}`}>
  {picture && (
    <a class={`media-card-image media-card-image--${mediaShape}`} href={href}>
      <picture>
        {picture.hasWebp && <source type="image/webp" srcset={picture.webpSrcset} />}
        <source type="image/jpeg" srcset={picture.jpgSrcset} />
        <img src={picture.src} alt={picture.alt} width={picture.width} height={picture.height} loading="lazy" />
      </picture>
    </a>
  )}
  <h3><a href={href}>{title}</a></h3>
  <p>{description}</p>
  {showMetaRow && dateUpdated && <p class="meta">Updated {new Date(dateUpdated).toLocaleDateString("en-MT")}</p>}
  {showCTA && <a class="btn btn--secondary" href={href}>Read guide</a>}
</article>
