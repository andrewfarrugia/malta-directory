---
import type { LocalPexelsImage } from "@/lib/pexelsImagePipeline";
import { toPictureData } from "@/lib/pexelsImagePipeline";

interface ContextRailItem {
  title: string;
  href: string;
  meta?: string;
  image: LocalPexelsImage;
}

interface Props {
  title: string;
  items: ContextRailItem[];
  variant?: "default" | "chips";
  sectionTone?: "light" | "muted";
}

const { title, items, variant = "default", sectionTone = "muted" } = Astro.props as Props;
---
<section class={`section section--${sectionTone}`}>
  <div class="container">
    <h2>{title}</h2>
    <div class={`context-rail context-rail--${variant}`}>
      {items.map((item) => {
        const image = toPictureData(item.image);
        return (
          <a class={`context-rail-card context-rail-card--${variant}`} href={item.href}>
            <picture>
              {image.hasWebp && <source type="image/webp" srcset={image.webpSrcset} />}
              <source type="image/jpeg" srcset={image.jpgSrcset} />
              <img src={image.src} alt={image.alt} width={image.width} height={image.height} loading="lazy" />
            </picture>
            <span>
              <strong>{item.title}</strong>
              {item.meta && <small>{item.meta}</small>}
            </span>
          </a>
        );
      })}
    </div>
  </div>
</section>
