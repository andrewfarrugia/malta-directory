---
import type { LocalPexelsImage } from "@/lib/pexelsImagePipeline";
import { toPictureData } from "@/lib/pexelsImagePipeline";

interface MastheadAction {
  href: string;
  label: string;
  variant?: "primary" | "secondary";
}

interface Props {
  title: string;
  description: string;
  kicker?: string;
  image: LocalPexelsImage;
  actions?: MastheadAction[];
  variant?: "default" | "hero" | "compact";
  density?: "comfortable" | "compact";
  mediaShape?: "rounded" | "pill";
  sectionTone?: "light" | "muted";
  showMetaRow?: boolean;
}

const {
  title,
  description,
  kicker,
  image,
  actions = [],
  variant = "default",
  density = "comfortable",
  mediaShape = "rounded",
  sectionTone = "light",
  showMetaRow = false
} = Astro.props as Props;
const picture = toPictureData(image);
---
<section class={`section masthead-media masthead-media--${variant} masthead-media--${density} masthead-media--${sectionTone}`}>
  <div class="container">
    <article class={`masthead-card masthead-card--${variant} masthead-card--${mediaShape}`}>
      <div class="masthead-content">
        {kicker && <p class="meta masthead-kicker">{kicker}</p>}
        <h1>{title}</h1>
        <p class="lead">{description}</p>
        {actions.length > 0 && (
          <div class="consent-actions mt-sm">
            {actions.map((action) => (
              <a class={`btn ${action.variant === "secondary" ? "btn--secondary" : "btn--primary"}`} href={action.href}>{action.label}</a>
            ))}
          </div>
        )}
      </div>
      <figure class="masthead-figure">
        <picture>
          {picture.hasWebp && <source type="image/webp" srcset={picture.webpSrcset} />}
          <source type="image/jpeg" srcset={picture.jpgSrcset} />
          <img src={picture.src} alt={picture.alt} width={picture.width} height={picture.height} />
        </picture>
        {picture.photographer && picture.photographerUrl && (
          <figcaption class="meta">
            Photo by <a href={picture.photographerUrl} rel="noopener nofollow" target="_blank">{picture.photographer}</a> on Pexels
          </figcaption>
        )}
      </figure>
    </article>
    {showMetaRow && (
      <div class="masthead-meta-row" aria-label="Quick search controls">
        <div><strong>Where</strong><span>Search destinations</span></div>
        <div><strong>When</strong><span>February 05 - March 14</span></div>
        <div><strong>Tour type</strong><span>All tour</span></div>
        <a class="btn btn--primary" href="/search/">Search</a>
      </div>
    )}
  </div>
</section>
